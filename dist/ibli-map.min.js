/**
 * ibli-map
 * @version v0.0.1 - 2014-09-01
 * @link https://github.com/Gizra/IBLI-map
 * @author  <>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("ibliApp",["leaflet-directive"]).constant("BACKEND_URL","http://127.0.0.1:9000").factory("ibliHttpInterceptor",["$q","BACKEND_URL",function(a,b){return{request:function(c){return c.serverPredefined&&(c._url=b,c.url=angular.isDefined(c.apiMock)&&c.apiMock?c.url:c._url+c.url),c||a.when(c)}}}]).factory("ibliData",["$http","$q",function(a,b){function c(){return["#00AA00","#DDDD00","#BB5500","#AA0000","#000000"]}function d(){return{weight:2,color:"#666666",fillColor:"white",fillOpacity:.3}}function e(){return{kenya:{lat:1.1864,lng:37.925,zoom:7},defaults:{minZoom:6,maxZoom:9},tiles:{url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{id:"v3/examples.map-20v6611k"}},maxbounds:{southWest:{lat:-2.3613917533090936,lng:31.662597656249996},northEast:{lat:3.984820817420321,lng:44.703369140625}},legend:{position:"bottomleft",colors:c(),labels:["0%-6%","6%-8%","8%-10%","10%-15%","15%-100%"]}}}function f(){var c=b.defer();return a({method:"GET",url:"sites/default/files/data/zCumNDVI_Percentile.csv",serverPredefined:!0}).success(function(a){var b=a,d=b.split("\n");for(var e in d)d[e]=d[e].split(",");var f=d.shift(),g=[];for(var h in f)f[h].match(/\d{4}[L|S]/)&&(g[f[h]]=[],d.forEach(function(a){g[f[h]].push(parseInt(a[h]))}));j=g["2013S"],c.resolve(j)}),c.promise}function g(){var c=Drupal.settings.ibli_general.iblimap_library_path,d=b.defer();return a({method:"GET",url:c+"/json/kenya.json",serverPredefined:!0}).success(function(a){var b={data:a,style:h,resetStyleOnMouseout:!0};d.resolve(b)}),d.promise}function h(a){return{fillColor:i(a.properties.DIV_ID),weight:2,opacity:1,color:"white",dashArray:"3",fillOpacity:.7}}function i(a){var b=j[a],d=c();return d[b-1]}var j=[];return{getMapOptions:function(){return e()},getHoverStyle:function(){return d()},getDivIdToIndex:function(){return f()},getGeoJson:function(){return g()}}}]).controller("MainCtrl",["$scope","$http","$compile","ibliData",function(a,b,c,d){angular.extend(a,d.getMapOptions()),d.getDivIdToIndex().then(function(b){a.divIdToIndex=b,d.getGeoJson().then(function(b){a.geojson=b})}),a.controls={custom:[]};var e=L.control();e.setPosition("bottomleft"),e.onAdd=function(){return c(angular.element("<hover-info></hover-info>"))(a)[0]},a.controls.custom.push(e),a.$on("leafletDirectiveMap.geojsonMouseover",function(a,b){var c=b.target;c.setStyle(d.getHoverStyle()),c.bringToFront()})}]).directive("hoverInfo",function(){var a=Drupal.settings.ibli_general.iblimap_library_path;return{templateUrl:a+"/templates/hover-info.html",restrict:"AEC"}});